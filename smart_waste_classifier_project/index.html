<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartWaste Classifier</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h1>Wasteless</h1>
    <div class="upload-section">
      <label for="imageInput" class="upload-label">
        <input type="file" id="imageInput" accept="image/*" />
        <span>Choose an Image</span>
      </label>
      <div class="preview">
        <img id="previewImage" alt="Preview" style="display: none;" />
      </div>
    </div>
    <button class="classify-btn" onclick="classifyImage()">Classify</button>
    <div id="result" class="result"></div>
  </div>

  <script>
    let model;
    const classes = ["Recyclable", "Compost", "Trash"];

    tf.loadLayersModel("tfjs_model/model.json").then(m => {
      model = m;
      console.log("Model loaded.");
    });

    const imageInput = document.getElementById("imageInput");
    const previewImage = document.getElementById("previewImage");

    imageInput.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImage.src = e.target.result;
          previewImage.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    function classifyImage() {
      if (!model) {
        alert("Model not loaded yet.");
        return;
      }

      const img = new Image();
      img.src = previewImage.src;
      img.onload = () => {
        const tensor = tf.browser.fromPixels(img)
          .resizeNearestNeighbor([224, 224])
          .toFloat()
          .div(255)
          .expandDims();

        const prediction = model.predict(tensor);
        prediction.array().then(preds => {
          const maxIndex = preds[0].indexOf(Math.max(...preds[0]));
          document.getElementById("result").innerHTML =
            `<strong>Predicted:</strong> ${classes[maxIndex]}`;
        });
      };
    }
  </script>
</body>
</html>
